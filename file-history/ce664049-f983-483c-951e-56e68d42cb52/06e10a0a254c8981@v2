"""
Test Case: TC-F-002-02
Requirement: F-002 - Standardize location values across frontend, backend, and database
Description: Create resource with home_location='Location 2', verify API returns 400 error with message "Location 'Location 2' not found"
Generated: 2025-10-27T00:00:00Z
"""

def test_TC_F_002_02():
    """Verify API rejects invalid location with clear error message"""
    import requests
    import json

    API_BASE_URL = "http://localhost:5000"

    # Prepare test data with invalid location
    test_resource = {
        "id": "TEST-R-001",
        "name": "Test Resource",
        "team": "Team A",
        "home_location": "Location 2",  # Invalid - not in locations table
        "contract_type": "day",
        "weekly_hours": 40,
        "resource_type": "internal",
        "qualifications": ["Q1"]
    }

    # Send POST request to create resource
    response = requests.post(
        f"{API_BASE_URL}/api/resources",
        json=test_resource,
        headers={"Content-Type": "application/json"}
    )

    # Verify response status code is 400 (Bad Request) or 500 (if FK constraint)
    assert response.status_code in [400, 500], \
        f"Expected status 400 or 500, got {response.status_code}"

    # Verify error message mentions the location
    response_data = response.json()
    assert "success" in response_data and response_data["success"] is False, \
        "Response should indicate failure"
    assert "error" in response_data, "Response should contain error message"

    error_msg = response_data["error"].lower()
    assert "location" in error_msg or "foreign key" in error_msg, \
        f"Error message should mention location or foreign key, got: {response_data['error']}"

    # Verify resource was not created
    get_response = requests.get(f"{API_BASE_URL}/api/resources/TEST-R-001")
    assert get_response.status_code == 404, \
        "Resource should not have been created"

    print(f"âœ“ API correctly rejected invalid location 'Location 2'")

if __name__ == "__main__":
    try:
        test_TC_F_002_02()
        print("TC-F-002-02: PASSED")
    except AssertionError as e:
        print(f"TC-F-002-02: FAILED - {e}")
    except Exception as e:
        print(f"TC-F-002-02: ERROR - {e}")
